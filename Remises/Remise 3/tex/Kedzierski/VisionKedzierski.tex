La section \ref{locIle} et \ref{locRobot} se déroule évidamment sur la station de base. Il est a noter que lors de la réception d'une nouvelle image, celle-ci commence par la redimentionner de sorte à ne contenir que la table. Par la suite, un Gaussian blur est effectué. C'est à ce stade que les détections sont effectuée. 

 \section{Localisation des iles et des trésors}
\label{locIle}
Le processus de localisation des îles est effectué, au tout début de la routine. Pour localiser les îles, chacune des quatre couleurs est filtrée et placée dans un masque afin d'effectuer un traitement individuel. Ensuite, les formes ayant une aire trop grande ou trop petite sont éliminées. Par la suite, les formes possédant un trou (contour enfant) avec un aire concidérable sont éliminées (voir \ref{locRobot}). Le système compare ensuite les contours restant des formes filtrées avec les formes géométriques en mémoire. De ce fait, celui-ci est en mesure d'identifier la forme qui possède le plus haut taux de compatibilité avec celles en mémoire. Si l'indice de précision est trop faible pour les quatres formes en mémoire, la forme est ignorée. Bien que ce processus soit déjà robuste, ceci est effectuée à dix reprises dans le but de conserver la liste d'île ayant la longueur la plus constante.
 \medbreak
Pour ce qui est de la localisation des trésors, un processus similaire est utilisé. L'image est filtrée (à dix reprises) avec la couleur des trésors, puis les formes détectées sont retenues ou non dépendamment de l'aire de celles-ci. Les formes des trésors ne sont donc pas comparées, mais les trésors ne se retrouvant pas sur le long des murs sont négligés. Cette dernièr opération s'efectue facilement puisque l'image est redimentionnée de sorte à ne contenir que la table avant la détection.
 
 
 \section{Localisation du robot}

\label{locRobot}
Puisque la détection des îles se déroule avec succès, la même base est appliquée au robot. En effet, sur le dessus de celui-ci se retrouve deux formes (carré et cercle) de la même couleur située sur le même axe. Par contre, afin de les différencier avec les îles, elles possèdent un trou blanc à l'intérieur (voir figure \ref{f:detectRobot}). L'image redimentionnée de la table est donc filtrée avec la couleur du robot et placée dans un masque. Ensuite (comme pour les îles), les formes ayant une aire trop grande ou trop petite sont éliminées. Par la suite, les formes ne possédant pas un trou (contour enfant) avec un aire concidérable sont éliminées. Le système compare ensuite les contours restant des formes filtrées avec les formes géométriques en mémoire. De ce fait, celui-ci est en mesure d'identifier la forme qui possède le plus haut taux de compatibilité avec celles en mémoire. Si l'indice de précision est trop faible pour les deux formes en mémoire, le robot ne sera pas détecté à cette itération. \medbreak
\begin{figure}[htp]
   \centering
   \includegraphics[width=0.5\textwidth]{fig/imageRobot.png}
   \caption{Image de la forme sur le robot}
   \label{f:detectRobot}
\end{figure}
Une fois les contours détectés, un peut de géométrie permet de d'obtenir les données voulues. Les formes sont positionnées de sorte à ce que le centre des deux centres est situé au centre du robot. L'orientation du robot est simplement l'orientation du vecteur reliant le centre du cercle et du carré (sachant que le cercle est l'avant du robot). \medbreak
Afin d'ajouter un peu de robustesse, suite à la première détection du robot, les détection suivante considère l'ancienne position du robot et procède à une analyse de fesabilité du déplacement. Si le déplacement est trop élevé, le robot n'est pas détecté. Dans l'éventualité ou le robot n'est pas détecté lors de dix itération consécutive, le robot est déclaré comme perdu et l'analyse de fesabilité de déplacement est ignorée jusqu'à ce qu'il soit retrouvé.

\section{Phases d'alignement du robot}
Tout d'abord, il est important de spécifier que la station de base gère les déplacements principaux du robot alors que le robot gère lui-même les phases d'alignements. Ceci dit, lorsque le robot est dirigé vers une position cible, la station de base lui indiquera quelle type d'alignement il doit effectuer. Il y a une phase d'alignement unique pour la capture d'un trésor, le dépôt de celui-ci sur l'île cible ainsi que pour l'amarrage du robot avec la station de recharge.
\medbreak
Les phases d'alignement regroupent plusieurs petites étapes. Tout commence avec le changement de l'orientation de la caméra embarquée. Celle-ci possède plusieurs positions prédéfinies, ce qui facilite grandement le déroulement du processus d'alignement.

\subsection{Capture du trésor}
Pour la capture du trésor, la caméra est placée en "position trésor" afin d'identifier le trésor et évaluer la distance le séparant du robot. Encore une fois, connaissant la position du préhenseur sur le robot, le robot calcule les ajustements nécessaires et les commandes appropriées sont envoyés. Une fois la commande de déplacement vertical effectuée, l'électroaimant sera activé et le robot reculera afin de valider que le trésor a bel et bien été capturé. La phase de préhension de trésor se termine donc et la station de base reprendra le contrôle du robot.  
\textbf{AJOUTER IMAGE}

\subsection{Dépôt du trésor}
Pour le dépôt du trésor, la caméra se positionnera face à la surface de jeu et analysera la position de l'île cible pour calculer le déplacement vertical et horizontal à effectuer. Une fois ces ajustements calculés, des commandes de déplacements sont envoyés. Finalement, une fois l'alignement terminé, le système valide la position de l'île cible par rapport à la zone de dépôt sécuritaire déterminée par des tests. Le trésor est soit déposé ou un autre alignement est effectué.
\textbf{AJOUTER IMAGE}

\subsection{Recharge du condensateur}
La phase d'alignement avec la station de recharge est une étape cruciale dans le déroulement de la routine. En effet, un mauvais alignement aura comme conséquence un plus long temps de recharge ou aucune recharge dans le pire des cas. Il est donc indispensable que le robot soit parfaitement aligné avec la station de recharge afin que la recharge à induction soit optimale, mais aussi afin que le code Manchester soit transmis avec succès par le système LED à LED. 
\textbf{A COMPLETER}

%Exemple d'insertion de figure

%\begin{figure}[htp]
%   \centering
%   \includegraphics[width=1\textwidth]{fig/trajet.png}
%   \caption{Exemple de trajectoire}
%   \label{f:Trajectoire}
%\end{figure}
%\pagebreak